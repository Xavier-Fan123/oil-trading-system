  正在确定要还原的项目…
  所有项目均是最新的，无法还原。
  OilTrading.Core -> c:\Users\itg\Desktop\X\src\OilTrading.Core\bin\Debug\net9.0\OilTrading.Core.dll
  OilTrading.Application -> c:\Users\itg\Desktop\X\src\OilTrading.Application\bin\Debug\net9.0\OilTrading.Application.dll
  OilTrading.Infrastructure -> c:\Users\itg\Desktop\X\src\OilTrading.Infrastructure\bin\Debug\net9.0\OilTrading.Infrastructure.dll
  OilTrading.Api -> c:\Users\itg\Desktop\X\src\OilTrading.Api\bin\Debug\net9.0\OilTrading.Api.dll
  OilTrading.Tests -> c:\Users\itg\Desktop\X\tests\OilTrading.Tests\bin\Debug\net9.0\OilTrading.Tests.dll
c:\Users\itg\Desktop\X\tests\OilTrading.Tests\bin\Debug\net9.0\OilTrading.Tests.dll (.NETCoreApp,Version=v9.0)的测试运行
VSTest 版本 17.14.1 (x64)

正在启动测试执行，请稍候...
总共 1 个测试文件与指定模式相匹配。
[xUnit.net 00:00:01.71]     OilTrading.Tests.Application.Commands.FinancialReports.FinancialReportValidatorTests.ReportEndDate_ExactlyToday_ShouldHaveValidationError [FAIL]
[xUnit.net 00:00:01.71]     OilTrading.Tests.Application.Commands.FinancialReports.FinancialReportValidatorTests.ReportPeriod_WithValidDays_ShouldNotHaveValidationError(days: 1) [FAIL]
  失败 OilTrading.Tests.Application.Commands.FinancialReports.FinancialReportValidatorTests.ReportEndDate_ExactlyToday_ShouldHaveValidationError [1 ms]
  错误消息:
   FluentValidation.TestHelper.ValidationTestException : Expected a validation error for property ReportEndDate
  堆栈跟踪:
     at FluentValidation.TestHelper.TestValidationResult`1.ShouldHaveValidationError(String propertyName, Boolean shouldNormalizePropertyName) in /_/src/FluentValidation/TestHelper/TestValidationResult.cs:line 82
   at FluentValidation.TestHelper.TestValidationResult`1.ShouldHaveValidationErrorFor[TProperty](Expression`1 memberAccessor) in /_/src/FluentValidation/TestHelper/TestValidationResult.cs:line 39
   at OilTrading.Tests.Application.Commands.FinancialReports.FinancialReportValidatorTests.ReportEndDate_ExactlyToday_ShouldHaveValidationError() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Application\Commands\FinancialReports\FinancialReportValidatorTests.cs:line 651
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
  失败 OilTrading.Tests.Application.Commands.FinancialReports.FinancialReportValidatorTests.ReportPeriod_WithValidDays_ShouldNotHaveValidationError(days: 1) [< 1 ms]
  错误消息:
   FluentValidation.TestHelper.ValidationTestException : Expected no validation errors
----
Validation Errors:
[0]: Report period must be at least 1 day

  堆栈跟踪:
     at FluentValidation.TestHelper.TestValidationResult`1.ShouldNotHaveValidationError(String propertyName, Boolean shouldNormalizePropertyName) in /_/src/FluentValidation/TestHelper/TestValidationResult.cs:line 102
   at FluentValidation.TestHelper.ValidationTestExtension.ShouldNotHaveAnyValidationErrors[T](TestValidationResult`1 testValidationResult) in /_/src/FluentValidation/TestHelper/ValidatorTestExtensions.cs:line 132
   at OilTrading.Tests.Application.Commands.FinancialReports.FinancialReportValidatorTests.ReportPeriod_WithValidDays_ShouldNotHaveValidationError(Int32 days) in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Application\Commands\FinancialReports\FinancialReportValidatorTests.cs:line 164
   at InvokeStub_FinancialReportValidatorTests.ReportPeriod_WithValidDays_ShouldNotHaveValidationError(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithOneArg(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
[xUnit.net 00:00:01.76]     OilTrading.Tests.Domain.ValueObjects.MoneyTests.Money_ShouldHandleEdgeCases(amount: -100, currency: "EUR") [FAIL]
[xUnit.net 00:00:01.76]     OilTrading.Tests.Application.Commands.FinancialReports.FinancialReportValidatorTests.ReportPeriod_WhenExceeds366Days_ShouldHaveValidationError [FAIL]
  失败 OilTrading.Tests.Domain.ValueObjects.MoneyTests.Money_ShouldHandleEdgeCases(amount: -100, currency: "EUR") [< 1 ms]
  错误消息:
   OilTrading.Core.Common.DomainException : Amount cannot be negative
  堆栈跟踪:
     at OilTrading.Core.ValueObjects.Money..ctor(Decimal amount, String currency) in c:\Users\itg\Desktop\X\src\OilTrading.Core\ValueObjects\Money.cs:line 15
   at OilTrading.Tests.Domain.ValueObjects.MoneyTests.Money_ShouldHandleEdgeCases(Decimal amount, String currency) in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Domain\ValueObjects\MoneyTests.cs:line 204
   at InvokeStub_MoneyTests.Money_ShouldHandleEdgeCases(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithFewArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
  失败 OilTrading.Tests.Application.Commands.FinancialReports.FinancialReportValidatorTests.ReportPeriod_WhenExceeds366Days_ShouldHaveValidationError [< 1 ms]
  错误消息:
   FluentValidation.TestHelper.ValidationTestException : Expected a validation error for property ReportEndDate
----
Properties with Validation Errors:
[0]: 

  堆栈跟踪:
     at FluentValidation.TestHelper.TestValidationResult`1.ShouldHaveValidationError(String propertyName, Boolean shouldNormalizePropertyName) in /_/src/FluentValidation/TestHelper/TestValidationResult.cs:line 82
   at FluentValidation.TestHelper.TestValidationResult`1.ShouldHaveValidationErrorFor[TProperty](Expression`1 memberAccessor) in /_/src/FluentValidation/TestHelper/TestValidationResult.cs:line 39
   at OilTrading.Tests.Application.Commands.FinancialReports.FinancialReportValidatorTests.ReportPeriod_WhenExceeds366Days_ShouldHaveValidationError() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Application\Commands\FinancialReports\FinancialReportValidatorTests.cs:line 126
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
[xUnit.net 00:00:01.76]     OilTrading.Tests.Application.Commands.FinancialReports.FinancialReportValidatorTests.CreatedBy_WhenEmpty_ShouldHaveValidationError [FAIL]
  失败 OilTrading.Tests.Application.Commands.FinancialReports.FinancialReportValidatorTests.CreatedBy_WhenEmpty_ShouldHaveValidationError [2 ms]
  错误消息:
   FluentValidation.TestHelper.ValidationTestException : Expected an error message of 'Created by is required and must not exceed 100 characters'. Actual message was ''Created By' 不能为空。'
  堆栈跟踪:
     at FluentValidation.TestHelper.ValidationTestExtension.When(ITestValidationContinuation failures, Func`2 failurePredicate, String exceptionMessage) in /_/src/FluentValidation/TestHelper/ValidatorTestExtensions.cs:line 163
   at FluentValidation.TestHelper.ValidationTestExtension.WithErrorMessage(ITestValidationContinuation failures, String expectedErrorMessage) in /_/src/FluentValidation/TestHelper/ValidatorTestExtensions.cs:line 199
   at OilTrading.Tests.Application.Commands.FinancialReports.FinancialReportValidatorTests.CreatedBy_WhenEmpty_ShouldHaveValidationError() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Application\Commands\FinancialReports\FinancialReportValidatorTests.cs:line 382
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
[xUnit.net 00:00:01.76]     OilTrading.Tests.Domain.ValueObjects.EnumsTests.DeliveryTerms_ShouldFailToParse_InvalidStrings(invalidString: "999") [FAIL]
  失败 OilTrading.Tests.Domain.ValueObjects.EnumsTests.DeliveryTerms_ShouldFailToParse_InvalidStrings(invalidString: "999") [97 ms]
  错误消息:
   Expected success to be false, but found True.
  堆栈跟踪:
     at FluentAssertions.Execution.XUnit2TestFramework.Throw(String message)
   at FluentAssertions.Execution.TestFrameworkProvider.Throw(String message)
   at FluentAssertions.Execution.DefaultAssertionStrategy.HandleFailure(String message)
   at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
   at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
   at FluentAssertions.Execution.AssertionScope.FailWith(String message, Object[] args)
   at FluentAssertions.Primitives.BooleanAssertions`1.BeFalse(String because, Object[] becauseArgs)
   at OilTrading.Tests.Domain.ValueObjects.EnumsTests.DeliveryTerms_ShouldFailToParse_InvalidStrings(String invalidString) in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Domain\ValueObjects\EnumsTests.cs:line 76
   at InvokeStub_EnumsTests.DeliveryTerms_ShouldFailToParse_InvalidStrings(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithOneArg(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
[xUnit.net 00:00:01.77]     OilTrading.Tests.Domain.Entities.FinancialReportTests.IsAnnualReport_WithVariousPeriods_ShouldClassifyCorrectly(days: 1, expectedIsAnnual: False) [FAIL]
  失败 OilTrading.Tests.Domain.Entities.FinancialReportTests.IsAnnualReport_WithVariousPeriods_ShouldClassifyCorrectly(days: 1, expectedIsAnnual: False) [< 1 ms]
  错误消息:
   OilTrading.Core.Common.DomainException : Report period must be at least 1 day
  堆栈跟踪:
     at OilTrading.Core.Entities.FinancialReport.ValidateReportPeriod() in c:\Users\itg\Desktop\X\src\OilTrading.Core\Entities\FinancialReport.cs:line 105
   at OilTrading.Core.Entities.FinancialReport..ctor(Guid tradingPartnerId, DateTime reportStartDate, DateTime reportEndDate) in c:\Users\itg\Desktop\X\src\OilTrading.Core\Entities\FinancialReport.cs:line 18
   at OilTrading.Tests.Domain.Entities.FinancialReportTests.IsAnnualReport_WithVariousPeriods_ShouldClassifyCorrectly(Int32 days, Boolean expectedIsAnnual) in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Domain\Entities\FinancialReportTests.cs:line 615
   at InvokeStub_FinancialReportTests.IsAnnualReport_WithVariousPeriods_ShouldClassifyCorrectly(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithFewArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
[xUnit.net 00:00:01.77]     OilTrading.Tests.Application.Commands.FinancialReports.FinancialReportValidatorTests.ReportPeriod_WhenLessThanOneDay_ShouldHaveValidationError [FAIL]
[xUnit.net 00:00:01.77]     OilTrading.Tests.Domain.Entities.FinancialReportTests.DebtToAssetRatio_WithValidValues_ShouldCalculateCorrectly(totalAssets: 100, totalLiabilities: 0, expectedRatio: 0) [FAIL]
  失败 OilTrading.Tests.Application.Commands.FinancialReports.FinancialReportValidatorTests.ReportPeriod_WhenLessThanOneDay_ShouldHaveValidationError [< 1 ms]
  错误消息:
   FluentValidation.TestHelper.ValidationTestException : Expected a validation error for property ReportEndDate
----
Properties with Validation Errors:
[0]: ReportStartDate
[1]: 

  堆栈跟踪:
     at FluentValidation.TestHelper.TestValidationResult`1.ShouldHaveValidationError(String propertyName, Boolean shouldNormalizePropertyName) in /_/src/FluentValidation/TestHelper/TestValidationResult.cs:line 82
   at FluentValidation.TestHelper.TestValidationResult`1.ShouldHaveValidationErrorFor[TProperty](Expression`1 memberAccessor) in /_/src/FluentValidation/TestHelper/TestValidationResult.cs:line 39
   at OilTrading.Tests.Application.Commands.FinancialReports.FinancialReportValidatorTests.ReportPeriod_WhenLessThanOneDay_ShouldHaveValidationError() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Application\Commands\FinancialReports\FinancialReportValidatorTests.cs:line 143
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
  失败 OilTrading.Tests.Domain.Entities.FinancialReportTests.DebtToAssetRatio_WithValidValues_ShouldCalculateCorrectly(totalAssets: 100, totalLiabilities: 0, expectedRatio: 0) [< 1 ms]
  错误消息:
   OilTrading.Core.Common.DomainException : Current liabilities cannot exceed total liabilities
  堆栈跟踪:
     at OilTrading.Core.Entities.FinancialReport.ValidateFinancialData() in c:\Users\itg\Desktop\X\src\OilTrading.Core\Entities\FinancialReport.cs:line 122
   at OilTrading.Core.Entities.FinancialReport.UpdateFinancialPosition(Nullable`1 totalAssets, Nullable`1 totalLiabilities, Nullable`1 netAssets, Nullable`1 currentAssets, Nullable`1 currentLiabilities) in c:\Users\itg\Desktop\X\src\OilTrading.Core\Entities\FinancialReport.cs:line 71
   at OilTrading.Tests.Domain.Entities.FinancialReportTests.DebtToAssetRatio_WithValidValues_ShouldCalculateCorrectly(Decimal totalAssets, Decimal totalLiabilities, Decimal expectedRatio) in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Domain\Entities\FinancialReportTests.cs:line 159
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeDirectByRefWithFewArgs(Object obj, Span`1 copyOfArgs, BindingFlags invokeAttr)
[xUnit.net 00:00:01.77]     OilTrading.Tests.Domain.Entities.FinancialReportTests.ReportYear_ShouldReturnStartDateYear(startDateString: "2025-12-31", expectedYear: 2025) [FAIL]
  失败 OilTrading.Tests.Domain.Entities.FinancialReportTests.ReportYear_ShouldReturnStartDateYear(startDateString: "2025-12-31", expectedYear: 2025) [< 1 ms]
  错误消息:
   OilTrading.Core.Common.DomainException : Report end date cannot be in the future
  堆栈跟踪:
     at OilTrading.Core.Entities.FinancialReport.ValidateReportPeriod() in c:\Users\itg\Desktop\X\src\OilTrading.Core\Entities\FinancialReport.cs:line 97
   at OilTrading.Core.Entities.FinancialReport..ctor(Guid tradingPartnerId, DateTime reportStartDate, DateTime reportEndDate) in c:\Users\itg\Desktop\X\src\OilTrading.Core\Entities\FinancialReport.cs:line 18
   at OilTrading.Tests.Domain.Entities.FinancialReportTests.ReportYear_ShouldReturnStartDateYear(String startDateString, Int32 expectedYear) in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Domain\Entities\FinancialReportTests.cs:line 347
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeDirectByRefWithFewArgs(Object obj, Span`1 copyOfArgs, BindingFlags invokeAttr)
[xUnit.net 00:00:01.79]     OilTrading.Tests.Domain.Entities.FinancialReportTests.ROA_WithZeroTotalAssets_ShouldReturnNull [FAIL]
[xUnit.net 00:00:01.79]     OilTrading.Tests.Domain.Entities.FinancialReportTests.Constructor_WithZeroDayPeriod_ShouldThrowDomainException [FAIL]
  失败 OilTrading.Tests.Domain.Entities.FinancialReportTests.ROA_WithZeroTotalAssets_ShouldReturnNull [< 1 ms]
  错误消息:
   OilTrading.Core.Common.DomainException : Current assets cannot exceed total assets
  堆栈跟踪:
     at OilTrading.Core.Entities.FinancialReport.ValidateFinancialData() in c:\Users\itg\Desktop\X\src\OilTrading.Core\Entities\FinancialReport.cs:line 119
   at OilTrading.Core.Entities.FinancialReport.UpdateFinancialPosition(Nullable`1 totalAssets, Nullable`1 totalLiabilities, Nullable`1 netAssets, Nullable`1 currentAssets, Nullable`1 currentLiabilities) in c:\Users\itg\Desktop\X\src\OilTrading.Core\Entities\FinancialReport.cs:line 71
   at OilTrading.Tests.Domain.Entities.FinancialReportTests.ROA_WithZeroTotalAssets_ShouldReturnNull() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Domain\Entities\FinancialReportTests.cs:line 328
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
  失败 OilTrading.Tests.Domain.Entities.FinancialReportTests.Constructor_WithZeroDayPeriod_ShouldThrowDomainException [2 ms]
  错误消息:
   Expected exception.Message "Report start date must be before end date" to contain "Report period must be at least 1 day".
  堆栈跟踪:
     at FluentAssertions.Execution.XUnit2TestFramework.Throw(String message)
   at FluentAssertions.Execution.TestFrameworkProvider.Throw(String message)
   at FluentAssertions.Execution.DefaultAssertionStrategy.HandleFailure(String message)
   at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
   at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
   at FluentAssertions.Execution.AssertionScope.FailWith(String message, Object[] args)
   at FluentAssertions.Primitives.StringAssertions`1.Contain(String expected, String because, Object[] becauseArgs)
   at OilTrading.Tests.Domain.Entities.FinancialReportTests.Constructor_WithZeroDayPeriod_ShouldThrowDomainException() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Domain\Entities\FinancialReportTests.cs:line 83
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
[xUnit.net 00:00:01.80]     OilTrading.Tests.Domain.Entities.FinancialReportTests.DebtToAssetRatio_WithZeroTotalAssets_ShouldReturnNull [FAIL]
  失败 OilTrading.Tests.Domain.Entities.FinancialReportTests.DebtToAssetRatio_WithZeroTotalAssets_ShouldReturnNull [< 1 ms]
  错误消息:
   OilTrading.Core.Common.DomainException : Current assets cannot exceed total assets
  堆栈跟踪:
     at OilTrading.Core.Entities.FinancialReport.ValidateFinancialData() in c:\Users\itg\Desktop\X\src\OilTrading.Core\Entities\FinancialReport.cs:line 119
   at OilTrading.Core.Entities.FinancialReport.UpdateFinancialPosition(Nullable`1 totalAssets, Nullable`1 totalLiabilities, Nullable`1 netAssets, Nullable`1 currentAssets, Nullable`1 currentLiabilities) in c:\Users\itg\Desktop\X\src\OilTrading.Core\Entities\FinancialReport.cs:line 71
   at OilTrading.Tests.Domain.Entities.FinancialReportTests.DebtToAssetRatio_WithZeroTotalAssets_ShouldReturnNull() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Domain\Entities\FinancialReportTests.cs:line 201
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
[xUnit.net 00:00:01.80]     OilTrading.Tests.Application.Services.CacheInvalidationServiceTests.InvalidateSalesContractCacheAsync_ShouldRemoveAllRelatedCaches [FAIL]
  失败 OilTrading.Tests.Application.Services.CacheInvalidationServiceTests.InvalidateSalesContractCacheAsync_ShouldRemoveAllRelatedCaches [5 ms]
  错误消息:
   System.NullReferenceException : Object reference not set to an instance of an object.
  堆栈跟踪:
     at lambda_method217(Closure, String)
   at Moq.It.<>c__DisplayClass6_0`1.<Is>b__0(TValue argument) in /_/src/Moq/It.cs:line 170
   at Moq.Match`1.Matches(Object argument, Type parameterType) in /_/src/Moq/Match.cs:line 177
   at Moq.Match.Moq.IMatcher.Matches(Object argument, Type parameterType) in /_/src/Moq/Match.cs:line 78
   at Moq.MethodExpectation.IsMatch(Invocation invocation) in /_/src/Moq/MethodExpectation.cs:line 286
   at System.Linq.Enumerable.ArrayWhereIterator`1.MoveNext()
   at Moq.Mock.GetMatchingInvocationCount(Mock mock, ImmutablePopOnlyStack`1& parts, HashSet`1 visitedInnerMocks, List`1 invocationsToBeMarkedAsVerified) in /_/src/Moq/Mock.cs:line 524
   at Moq.Mock.GetMatchingInvocationCount(Mock mock, LambdaExpression expression, List`1& invocationsToBeMarkedAsVerified) in /_/src/Moq/Mock.cs:line 475
   at Moq.Mock.Verify(Mock mock, LambdaExpression expression, Times times, String failMessage) in /_/src/Moq/Mock.cs:line 319
   at Moq.Mock`1.Verify[TResult](Expression`1 expression, Times times) in /_/src/Moq/Mock`1.cs:line 1018
   at OilTrading.Tests.Application.Services.CacheInvalidationServiceTests.InvalidateSalesContractCacheAsync_ShouldRemoveAllRelatedCaches() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Application\Services\CacheInvalidationServiceTests.cs:line 66
--- End of stack trace from previous location ---
[xUnit.net 00:00:01.82]     OilTrading.Tests.Application.Services.CacheInvalidationServiceTests.InvalidatePurchaseContractCacheAsync_ShouldRemoveAllRelatedCaches [FAIL]
  失败 OilTrading.Tests.Application.Services.CacheInvalidationServiceTests.InvalidatePurchaseContractCacheAsync_ShouldRemoveAllRelatedCaches [3 ms]
  错误消息:
   System.NullReferenceException : Object reference not set to an instance of an object.
  堆栈跟踪:
     at lambda_method415(Closure, String)
   at Moq.It.<>c__DisplayClass6_0`1.<Is>b__0(TValue argument) in /_/src/Moq/It.cs:line 170
   at Moq.Match`1.Matches(Object argument, Type parameterType) in /_/src/Moq/Match.cs:line 177
   at Moq.Match.Moq.IMatcher.Matches(Object argument, Type parameterType) in /_/src/Moq/Match.cs:line 78
   at Moq.MethodExpectation.IsMatch(Invocation invocation) in /_/src/Moq/MethodExpectation.cs:line 286
   at System.Linq.Enumerable.ArrayWhereIterator`1.MoveNext()
   at Moq.Mock.GetMatchingInvocationCount(Mock mock, ImmutablePopOnlyStack`1& parts, HashSet`1 visitedInnerMocks, List`1 invocationsToBeMarkedAsVerified) in /_/src/Moq/Mock.cs:line 524
   at Moq.Mock.GetMatchingInvocationCount(Mock mock, LambdaExpression expression, List`1& invocationsToBeMarkedAsVerified) in /_/src/Moq/Mock.cs:line 475
   at Moq.Mock.Verify(Mock mock, LambdaExpression expression, Times times, String failMessage) in /_/src/Moq/Mock.cs:line 319
   at Moq.Mock`1.Verify[TResult](Expression`1 expression, Times times) in /_/src/Moq/Mock`1.cs:line 1018
   at OilTrading.Tests.Application.Services.CacheInvalidationServiceTests.InvalidatePurchaseContractCacheAsync_ShouldRemoveAllRelatedCaches() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Application\Services\CacheInvalidationServiceTests.cs:line 34
--- End of stack trace from previous location ---
[xUnit.net 00:00:01.84]     OilTrading.Tests.Middleware.GlobalExceptionMiddlewareTests.NotFoundException_WithEntityDetails_ReturnsDetailsInResponse [FAIL]
  失败 OilTrading.Tests.Middleware.GlobalExceptionMiddlewareTests.NotFoundException_WithEntityDetails_ReturnsDetailsInResponse [1 ms]
  错误消息:
   Assert.NotNull() Failure
  堆栈跟踪:
     at OilTrading.Tests.Middleware.GlobalExceptionMiddlewareTests.NotFoundException_WithEntityDetails_ReturnsDetailsInResponse() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Middleware\GlobalExceptionMiddlewareTests.cs:line 118
--- End of stack trace from previous location ---
[xUnit.net 00:00:01.87]     OilTrading.Tests.Domain.Entities.SalesContractTests.IsHighRisk_ShouldReturnTrue_WhenHighRiskTagExists [FAIL]
  失败 OilTrading.Tests.Domain.Entities.SalesContractTests.IsHighRisk_ShouldReturnTrue_WhenHighRiskTagExists [4 ms]
  错误消息:
   System.NullReferenceException : Object reference not set to an instance of an object.
  堆栈跟踪:
     at OilTrading.Core.Entities.SalesContract.<>c__DisplayClass196_0.<HasTag>b__0(ContractTag ct) in c:\Users\itg\Desktop\X\src\OilTrading.Core\Entities\SalesContract.cs:line 385
   at System.Linq.Enumerable.Any[TSource](IEnumerable`1 source, Func`2 predicate)
   at OilTrading.Core.Entities.SalesContract.HasTag(String tagName) in c:\Users\itg\Desktop\X\src\OilTrading.Core\Entities\SalesContract.cs:line 385
   at OilTrading.Core.Entities.SalesContract.IsHighRisk() in c:\Users\itg\Desktop\X\src\OilTrading.Core\Entities\SalesContract.cs:line 417
   at OilTrading.Tests.Domain.Entities.SalesContractTests.IsHighRisk_ShouldReturnTrue_WhenHighRiskTagExists() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Domain\Entities\SalesContractTests.cs:line 689
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
[xUnit.net 00:00:01.90]     OilTrading.Tests.Domain.Entities.PurchaseContractTests.PurchaseContract_ShouldActivate_WhenInDraftStatus [FAIL]
  失败 OilTrading.Tests.Domain.Entities.PurchaseContractTests.PurchaseContract_ShouldActivate_WhenInDraftStatus [3 ms]
  错误消息:
   OilTrading.Core.Common.DomainException : Contract validation failed: Valid price formula is required, Contract value is required, Laycan dates are required, Load port is required, Discharge port is required, Payment terms are required
  堆栈跟踪:
     at OilTrading.Core.Entities.PurchaseContract.ValidateForActivation() in c:\Users\itg\Desktop\X\src\OilTrading.Core\Entities\PurchaseContract.cs:line 413
   at OilTrading.Core.Entities.PurchaseContract.Activate() in c:\Users\itg\Desktop\X\src\OilTrading.Core\Entities\PurchaseContract.cs:line 333
   at OilTrading.Tests.Domain.Entities.PurchaseContractTests.PurchaseContract_ShouldActivate_WhenInDraftStatus() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Domain\Entities\PurchaseContractTests.cs:line 289
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
[xUnit.net 00:00:01.91]     OilTrading.Tests.Domain.Entities.SalesContractTests.IsUrgent_ShouldReturnTrue_WhenUrgentTagExists [FAIL]
[xUnit.net 00:00:01.91]     OilTrading.Tests.Domain.Entities.PurchaseContractTests.PurchaseContract_ShouldThrowInvalidOperationException_WhenActivatingNonDraftContract [FAIL]
  失败 OilTrading.Tests.Domain.Entities.SalesContractTests.IsUrgent_ShouldReturnTrue_WhenUrgentTagExists [< 1 ms]
  错误消息:
   System.NullReferenceException : Object reference not set to an instance of an object.
  堆栈跟踪:
     at OilTrading.Core.Entities.SalesContract.<>c__DisplayClass196_0.<HasTag>b__0(ContractTag ct) in c:\Users\itg\Desktop\X\src\OilTrading.Core\Entities\SalesContract.cs:line 385
   at System.Linq.Enumerable.Any[TSource](IEnumerable`1 source, Func`2 predicate)
   at OilTrading.Core.Entities.SalesContract.HasTag(String tagName) in c:\Users\itg\Desktop\X\src\OilTrading.Core\Entities\SalesContract.cs:line 385
   at OilTrading.Core.Entities.SalesContract.IsUrgent() in c:\Users\itg\Desktop\X\src\OilTrading.Core\Entities\SalesContract.cs:line 425
   at OilTrading.Tests.Domain.Entities.SalesContractTests.IsUrgent_ShouldReturnTrue_WhenUrgentTagExists() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Domain\Entities\SalesContractTests.cs:line 700
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
  失败 OilTrading.Tests.Domain.Entities.PurchaseContractTests.PurchaseContract_ShouldThrowInvalidOperationException_WhenActivatingNonDraftContract [< 1 ms]
  错误消息:
   OilTrading.Core.Common.DomainException : Contract validation failed: Valid price formula is required, Contract value is required, Laycan dates are required, Load port is required, Discharge port is required, Payment terms are required
  堆栈跟踪:
     at OilTrading.Core.Entities.PurchaseContract.ValidateForActivation() in c:\Users\itg\Desktop\X\src\OilTrading.Core\Entities\PurchaseContract.cs:line 413
   at OilTrading.Core.Entities.PurchaseContract.Activate() in c:\Users\itg\Desktop\X\src\OilTrading.Core\Entities\PurchaseContract.cs:line 333
   at OilTrading.Tests.Domain.Entities.PurchaseContractTests.PurchaseContract_ShouldThrowInvalidOperationException_WhenActivatingNonDraftContract() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Domain\Entities\PurchaseContractTests.cs:line 303
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
[xUnit.net 00:00:01.92]     OilTrading.Tests.Domain.Entities.PurchaseContractTests.PurchaseContract_ShouldComplete_WhenActive [FAIL]
  失败 OilTrading.Tests.Domain.Entities.PurchaseContractTests.PurchaseContract_ShouldComplete_WhenActive [< 1 ms]
  错误消息:
   OilTrading.Core.Common.DomainException : Contract validation failed: Valid price formula is required, Contract value is required, Laycan dates are required, Load port is required, Discharge port is required, Payment terms are required
  堆栈跟踪:
     at OilTrading.Core.Entities.PurchaseContract.ValidateForActivation() in c:\Users\itg\Desktop\X\src\OilTrading.Core\Entities\PurchaseContract.cs:line 413
   at OilTrading.Core.Entities.PurchaseContract.Activate() in c:\Users\itg\Desktop\X\src\OilTrading.Core\Entities\PurchaseContract.cs:line 333
   at OilTrading.Tests.Domain.Entities.PurchaseContractTests.PurchaseContract_ShouldComplete_WhenActive() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Domain\Entities\PurchaseContractTests.cs:line 334
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
[xUnit.net 00:00:01.93]     OilTrading.Tests.Domain.Entities.UserTests.User_ShouldHaveDefaultValues_WhenCreated [FAIL]
  失败 OilTrading.Tests.Domain.Entities.UserTests.User_ShouldHaveDefaultValues_WhenCreated [4 ms]
  错误消息:
   Expected user.Role to be UserRole.Trader {value: 1}, but found UserRole.0 {value: 0}.
  堆栈跟踪:
     at FluentAssertions.Execution.XUnit2TestFramework.Throw(String message)
   at FluentAssertions.Execution.TestFrameworkProvider.Throw(String message)
   at FluentAssertions.Execution.DefaultAssertionStrategy.HandleFailure(String message)
   at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
   at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
   at FluentAssertions.Execution.AssertionScope.FailWith(String message, Object[] args)
   at FluentAssertions.Primitives.EnumAssertions`2.Be(TEnum expected, String because, Object[] becauseArgs)
   at OilTrading.Tests.Domain.Entities.UserTests.User_ShouldHaveDefaultValues_WhenCreated() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Domain\Entities\UserTests.cs:line 26
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
[xUnit.net 00:00:01.94]     OilTrading.Tests.Domain.Entities.PurchaseContractTests.PurchaseContract_ShouldThrowInvalidOperationException_WhenCompletingNonActiveContract [FAIL]
[xUnit.net 00:00:01.94]     OilTrading.Tests.Application.Commands.PurchaseContracts.CreatePurchaseContractCommandHandlerTests.Handle_ShouldThrowArgumentException_WhenInvalidDeliveryTerms [FAIL]
  失败 OilTrading.Tests.Domain.Entities.PurchaseContractTests.PurchaseContract_ShouldThrowInvalidOperationException_WhenCompletingNonActiveContract [1 ms]
  错误消息:
   Assert.Throws() Failure
Expected: typeof(System.InvalidOperationException)
Actual:   typeof(OilTrading.Core.Common.DomainException): Cannot complete contract from Draft status
---- OilTrading.Core.Common.DomainException : Cannot complete contract from Draft status
  堆栈跟踪:
     at OilTrading.Core.Entities.PurchaseContract.Complete() in c:\Users\itg\Desktop\X\src\OilTrading.Core\Entities\PurchaseContract.cs:line 342
   at OilTrading.Tests.Domain.Entities.PurchaseContractTests.<>c__DisplayClass24_0.<PurchaseContract_ShouldThrowInvalidOperationException_WhenCompletingNonActiveContract>b__0() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Domain\Entities\PurchaseContractTests.cs:line 354
----- Inner Stack Trace -----
   at OilTrading.Core.Entities.PurchaseContract.Complete() in c:\Users\itg\Desktop\X\src\OilTrading.Core\Entities\PurchaseContract.cs:line 342
   at OilTrading.Tests.Domain.Entities.PurchaseContractTests.<>c__DisplayClass24_0.<PurchaseContract_ShouldThrowInvalidOperationException_WhenCompletingNonActiveContract>b__0() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Domain\Entities\PurchaseContractTests.cs:line 354
  失败 OilTrading.Tests.Application.Commands.PurchaseContracts.CreatePurchaseContractCommandHandlerTests.Handle_ShouldThrowArgumentException_WhenInvalidDeliveryTerms [17 ms]
  错误消息:
   Assert.Throws() Failure
Expected: typeof(System.ArgumentException)
Actual:   (No exception was thrown)
  堆栈跟踪:
     at OilTrading.Tests.Application.Commands.PurchaseContracts.CreatePurchaseContractCommandHandlerTests.Handle_ShouldThrowArgumentException_WhenInvalidDeliveryTerms() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Application\Commands\PurchaseContracts\CreatePurchaseContractCommandHandlerTests.cs:line 338
--- End of stack trace from previous location ---
[xUnit.net 00:00:01.94]     OilTrading.Tests.Middleware.GlobalExceptionMiddlewareTests.GenericException_Returns500WithInternalServerError [FAIL]
  失败 OilTrading.Tests.Middleware.GlobalExceptionMiddlewareTests.GenericException_Returns500WithInternalServerError [7 ms]
  错误消息:
   Assert.Equal() Failure
Expected: Please contact support if the problem persists. (System.String)
Actual:   Please contact support if the problem persists. (System.Text.Json.JsonElement)
  堆栈跟踪:
     at OilTrading.Tests.Middleware.GlobalExceptionMiddlewareTests.GenericException_Returns500WithInternalServerError() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Middleware\GlobalExceptionMiddlewareTests.cs:line 495
--- End of stack trace from previous location ---
[xUnit.net 00:00:01.96]     OilTrading.Tests.Domain.Entities.SalesContractTests.HasTag_ShouldReturnTrue_WhenTagExists [FAIL]
  失败 OilTrading.Tests.Domain.Entities.SalesContractTests.HasTag_ShouldReturnTrue_WhenTagExists [1 ms]
  错误消息:
   System.NullReferenceException : Object reference not set to an instance of an object.
  堆栈跟踪:
     at OilTrading.Core.Entities.SalesContract.<>c__DisplayClass196_0.<HasTag>b__0(ContractTag ct) in c:\Users\itg\Desktop\X\src\OilTrading.Core\Entities\SalesContract.cs:line 385
   at System.Linq.Enumerable.Any[TSource](IEnumerable`1 source, Func`2 predicate)
   at OilTrading.Core.Entities.SalesContract.HasTag(String tagName) in c:\Users\itg\Desktop\X\src\OilTrading.Core\Entities\SalesContract.cs:line 385
   at OilTrading.Tests.Domain.Entities.SalesContractTests.HasTag_ShouldReturnTrue_WhenTagExists() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Domain\Entities\SalesContractTests.cs:line 666
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
[xUnit.net 00:00:01.96]     OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldParseAndRecreateCorrectly(formula: "ICE BRENT + 10.25 USD") [FAIL]
[xUnit.net 00:00:01.96]     OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldParseAndRecreateCorrectly(formula: "BRENT + 5.00 USD") [FAIL]
  失败 OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldParseAndRecreateCorrectly(formula: "ICE BRENT + 10.25 USD") [30 ms]
  错误消息:
   Expected recreatedFormula to be "ICE BRENT + 10.25 USD" with a length of 21, but "AVG(ICE BRENT) + 10.25 USD/USD" has a length of 30, differs near "AVG" (index 0).
  堆栈跟踪:
     at FluentAssertions.Execution.XUnit2TestFramework.Throw(String message)
   at FluentAssertions.Execution.TestFrameworkProvider.Throw(String message)
   at FluentAssertions.Execution.DefaultAssertionStrategy.HandleFailure(String message)
   at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
   at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
   at FluentAssertions.Primitives.StringEqualityValidator.ValidateAgainstLengthDifferences()
   at FluentAssertions.Primitives.StringValidator.Validate()
   at FluentAssertions.Primitives.StringAssertions`1.Be(String expected, String because, Object[] becauseArgs)
   at OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldParseAndRecreateCorrectly(String formula) in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Domain\ValueObjects\PriceFormulaTests.cs:line 292
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeDirectByRefWithFewArgs(Object obj, Span`1 copyOfArgs, BindingFlags invokeAttr)
  失败 OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldParseAndRecreateCorrectly(formula: "BRENT + 5.00 USD") [1 ms]
  错误消息:
   Expected recreatedFormula to be "BRENT + 5.00 USD" with a length of 16, but "AVG(BRENT) + 5.00 USD/USD" has a length of 25, differs near "AVG" (index 0).
  堆栈跟踪:
     at FluentAssertions.Execution.XUnit2TestFramework.Throw(String message)
   at FluentAssertions.Execution.TestFrameworkProvider.Throw(String message)
   at FluentAssertions.Execution.DefaultAssertionStrategy.HandleFailure(String message)
   at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
   at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
   at FluentAssertions.Primitives.StringEqualityValidator.ValidateAgainstLengthDifferences()
   at FluentAssertions.Primitives.StringValidator.Validate()
   at FluentAssertions.Primitives.StringAssertions`1.Be(String expected, String because, Object[] becauseArgs)
   at OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldParseAndRecreateCorrectly(String formula) in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Domain\ValueObjects\PriceFormulaTests.cs:line 292
   at InvokeStub_PriceFormulaTests.PriceFormula_ShouldParseAndRecreateCorrectly(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithOneArg(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
[xUnit.net 00:00:01.96]     OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldParseAndRecreateCorrectly(formula: "WTI - 2.50 EUR") [FAIL]
[xUnit.net 00:00:01.96]     OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldParseValidFormula_FloatingWithDiscount [FAIL]
[xUnit.net 00:00:01.96]     OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldParseValidFormula_FloatingWithPremium [FAIL]
  失败 OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldParseAndRecreateCorrectly(formula: "WTI - 2.50 EUR") [< 1 ms]
  错误消息:
   OilTrading.Core.Common.DomainException : Amount cannot be negative
  堆栈跟踪:
     at OilTrading.Core.ValueObjects.Money..ctor(Decimal amount, String currency) in c:\Users\itg\Desktop\X\src\OilTrading.Core\ValueObjects\Money.cs:line 15
   at OilTrading.Core.ValueObjects.PriceFormula.Parse(String formula) in c:\Users\itg\Desktop\X\src\OilTrading.Core\ValueObjects\PriceFormula.cs:line 202
   at OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldParseAndRecreateCorrectly(String formula) in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Domain\ValueObjects\PriceFormulaTests.cs:line 288
   at InvokeStub_PriceFormulaTests.PriceFormula_ShouldParseAndRecreateCorrectly(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithOneArg(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
  失败 OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldParseValidFormula_FloatingWithDiscount [< 1 ms]
  错误消息:
   OilTrading.Core.Common.DomainException : Amount cannot be negative
  堆栈跟踪:
     at OilTrading.Core.ValueObjects.Money..ctor(Decimal amount, String currency) in c:\Users\itg\Desktop\X\src\OilTrading.Core\ValueObjects\Money.cs:line 15
   at OilTrading.Core.ValueObjects.PriceFormula.Parse(String formula) in c:\Users\itg\Desktop\X\src\OilTrading.Core\ValueObjects\PriceFormula.cs:line 202
   at OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldParseValidFormula_FloatingWithDiscount() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Domain\ValueObjects\PriceFormulaTests.cs:line 124
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
  失败 OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldParseValidFormula_FloatingWithPremium [2 ms]
  错误消息:
   Expected priceFormula.Formula to be "BRENT + 5.00 USD" with a length of 16, but "AVG(BRENT) + 5.00 USD/USD" has a length of 25, differs near "AVG" (index 0).
  堆栈跟踪:
     at FluentAssertions.Execution.XUnit2TestFramework.Throw(String message)
   at FluentAssertions.Execution.TestFrameworkProvider.Throw(String message)
   at FluentAssertions.Execution.DefaultAssertionStrategy.HandleFailure(String message)
   at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
   at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
   at FluentAssertions.Primitives.StringEqualityValidator.ValidateAgainstLengthDifferences()
   at FluentAssertions.Primitives.StringValidator.Validate()
   at FluentAssertions.Primitives.StringAssertions`1.Be(String expected, String because, Object[] becauseArgs)
   at OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldParseValidFormula_FloatingWithPremium() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Domain\ValueObjects\PriceFormulaTests.cs:line 114
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
[xUnit.net 00:00:01.96]     OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldThrowArgumentException_WhenFormulaIsInvalid [FAIL]
  失败 OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldThrowArgumentException_WhenFormulaIsInvalid [< 1 ms]
  错误消息:
   Assert.Throws() Failure
Expected: typeof(OilTrading.Core.Common.DomainException)
Actual:   (No exception was thrown)
  堆栈跟踪:
     at OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldThrowArgumentException_WhenFormulaIsInvalid() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Domain\ValueObjects\PriceFormulaTests.cs:line 158
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
[xUnit.net 00:00:01.96]     OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldCreateFloatingPrice_WithIndexAndDiscount [FAIL]
[xUnit.net 00:00:01.96]     OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldHandleComplexFormula_WithAveraging [FAIL]
[xUnit.net 00:00:01.96]     OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldBeEqual_WhenFormulaIsTheSame [FAIL]
  失败 OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldCreateFloatingPrice_WithIndexAndDiscount [< 1 ms]
  错误消息:
   OilTrading.Core.Common.DomainException : Amount cannot be negative
  堆栈跟踪:
     at OilTrading.Core.ValueObjects.Money..ctor(Decimal amount, String currency) in c:\Users\itg\Desktop\X\src\OilTrading.Core\ValueObjects\Money.cs:line 15
   at OilTrading.Core.ValueObjects.Money.Dollar(Decimal amount) in c:\Users\itg\Desktop\X\src\OilTrading.Core\ValueObjects\Money.cs:line 28
   at OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldCreateFloatingPrice_WithIndexAndDiscount() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Domain\ValueObjects\PriceFormulaTests.cs:line 56
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
  失败 OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldHandleComplexFormula_WithAveraging [2 ms]
  错误消息:
   Expected priceFormula.Formula to be "AVG(BRENT) + 3.50 USD" with a length of 21, but "AVG(BRENT) + 3.50 USD/USD" has a length of 25, differs near "/US" (index 21).
  堆栈跟踪:
     at FluentAssertions.Execution.XUnit2TestFramework.Throw(String message)
   at FluentAssertions.Execution.TestFrameworkProvider.Throw(String message)
   at FluentAssertions.Execution.DefaultAssertionStrategy.HandleFailure(String message)
   at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
   at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
   at FluentAssertions.Primitives.StringEqualityValidator.ValidateAgainstLengthDifferences()
   at FluentAssertions.Primitives.StringValidator.Validate()
   at FluentAssertions.Primitives.StringAssertions`1.Be(String expected, String because, Object[] becauseArgs)
   at OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldHandleComplexFormula_WithAveraging() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Domain\ValueObjects\PriceFormulaTests.cs:line 306
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
  失败 OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldBeEqual_WhenFormulaIsTheSame [15 ms]
  错误消息:
   Expected (formula1 == formula2) to be true, but found False.
  堆栈跟踪:
     at FluentAssertions.Execution.XUnit2TestFramework.Throw(String message)
   at FluentAssertions.Execution.TestFrameworkProvider.Throw(String message)
   at FluentAssertions.Execution.DefaultAssertionStrategy.HandleFailure(String message)
   at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
   at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
   at FluentAssertions.Execution.AssertionScope.FailWith(String message, Object[] args)
   at FluentAssertions.Primitives.BooleanAssertions`1.BeTrue(String because, Object[] becauseArgs)
   at OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldBeEqual_WhenFormulaIsTheSame() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Domain\ValueObjects\PriceFormulaTests.cs:line 235
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
[xUnit.net 00:00:01.97]     OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldCreateFloatingPrice_WithIndexOnly [FAIL]
[xUnit.net 00:00:01.97]     OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldParseValidFormula_IndexOnly [FAIL]
[xUnit.net 00:00:01.97]     OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldCalculateBasePrice_ForFloatingPriceWithDiscount [FAIL]
  失败 OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldCreateFloatingPrice_WithIndexOnly [1 ms]
  错误消息:
   Expected priceFormula.Formula to be "DUBAI" with a length of 5, but "AVG(DUBAI)" has a length of 10, differs near "AVG" (index 0).
  堆栈跟踪:
     at FluentAssertions.Execution.XUnit2TestFramework.Throw(String message)
   at FluentAssertions.Execution.TestFrameworkProvider.Throw(String message)
   at FluentAssertions.Execution.DefaultAssertionStrategy.HandleFailure(String message)
   at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
   at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
   at FluentAssertions.Primitives.StringEqualityValidator.ValidateAgainstLengthDifferences()
   at FluentAssertions.Primitives.StringValidator.Validate()
   at FluentAssertions.Primitives.StringAssertions`1.Be(String expected, String because, Object[] becauseArgs)
   at OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldCreateFloatingPrice_WithIndexOnly() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Domain\ValueObjects\PriceFormulaTests.cs:line 82
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
  失败 OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldParseValidFormula_IndexOnly [1 ms]
  错误消息:
   Expected priceFormula.IndexName to be "DUBAI", but found <null>.
  堆栈跟踪:
     at FluentAssertions.Execution.XUnit2TestFramework.Throw(String message)
   at FluentAssertions.Execution.TestFrameworkProvider.Throw(String message)
   at FluentAssertions.Execution.DefaultAssertionStrategy.HandleFailure(String message)
   at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
   at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
   at FluentAssertions.Execution.AssertionScope.FailWith(String message, Object[] args)
   at FluentAssertions.Primitives.StringValidator.ValidateAgainstNulls()
   at FluentAssertions.Primitives.StringValidator.Validate()
   at FluentAssertions.Primitives.StringAssertions`1.Be(String expected, String because, Object[] becauseArgs)
   at OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldParseValidFormula_IndexOnly() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Domain\ValueObjects\PriceFormulaTests.cs:line 145
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
  失败 OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldCalculateBasePrice_ForFloatingPriceWithDiscount [< 1 ms]
  错误消息:
   OilTrading.Core.Common.DomainException : Amount cannot be negative
  堆栈跟踪:
     at OilTrading.Core.ValueObjects.Money..ctor(Decimal amount, String currency) in c:\Users\itg\Desktop\X\src\OilTrading.Core\ValueObjects\Money.cs:line 15
   at OilTrading.Core.ValueObjects.Money.Dollar(Decimal amount) in c:\Users\itg\Desktop\X\src\OilTrading.Core\ValueObjects\Money.cs:line 28
   at OilTrading.Tests.Domain.ValueObjects.PriceFormulaTests.PriceFormula_ShouldCalculateBasePrice_ForFloatingPriceWithDiscount() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Domain\ValueObjects\PriceFormulaTests.cs:line 202
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
[xUnit.net 00:00:01.98]     OilTrading.Tests.Application.Commands.PurchaseContracts.CreatePurchaseContractCommandHandlerTests.Handle_ShouldSetFormulaPricing_WhenPricingFormulaProvided [FAIL]
[xUnit.net 00:00:02.00]     OilTrading.Tests.Application.Commands.PurchaseContracts.CreatePurchaseContractCommandHandlerTests.Handle_ShouldCreatePurchaseContract_WhenValidFormulaPriceCommandProvided [FAIL]
[xUnit.net 00:00:02.00]     OilTrading.Tests.Application.Commands.PurchaseContracts.CreatePurchaseContractCommandHandlerTests.Handle_ShouldThrowArgumentException_WhenInvalidQuantityUnit [FAIL]
  失败 OilTrading.Tests.Application.Commands.PurchaseContracts.CreatePurchaseContractCommandHandlerTests.Handle_ShouldSetFormulaPricing_WhenPricingFormulaProvided [13 ms]
  错误消息:
   Moq.MockException : 
Expected invocation on the mock once, but was 0 times: x => x.AddAsync(It.Is<PurchaseContract>(c => ((c.PriceFormula != null && c.PriceFormula.Formula == command.PricingFormula) && c.ContractValue != null) && c.ContractValue.Amount == 0), It.IsAny<CancellationToken>())

Performed invocations:

   Mock<IPurchaseContractRepository:17> (x):

      IRepository<PurchaseContract>.AddAsync(PurchaseContract, CancellationToken)

  堆栈跟踪:
     at Moq.Mock.Verify(Mock mock, LambdaExpression expression, Times times, String failMessage) in /_/src/Moq/Mock.cs:line 331
   at Moq.Mock`1.Verify[TResult](Expression`1 expression, Func`1 times) in /_/src/Moq/Mock`1.cs:line 1033
   at OilTrading.Tests.Application.Commands.PurchaseContracts.CreatePurchaseContractCommandHandlerTests.Handle_ShouldSetFormulaPricing_WhenPricingFormulaProvided() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Application\Commands\PurchaseContracts\CreatePurchaseContractCommandHandlerTests.cs:line 414
--- End of stack trace from previous location ---
  失败 OilTrading.Tests.Application.Commands.PurchaseContracts.CreatePurchaseContractCommandHandlerTests.Handle_ShouldCreatePurchaseContract_WhenValidFormulaPriceCommandProvided [6 ms]
  错误消息:
   Moq.MockException : 
Expected invocation on the mock once, but was 0 times: x => x.AddAsync(It.Is<PurchaseContract>(c => (c.ContractNumber.Value == expectedContractNumber && c.PriceFormula != null) && c.PriceFormula.Formula == command.PricingFormula), It.IsAny<CancellationToken>())

Performed invocations:

   Mock<IPurchaseContractRepository:19> (x):

      IRepository<PurchaseContract>.AddAsync(PurchaseContract, CancellationToken)

  堆栈跟踪:
     at Moq.Mock.Verify(Mock mock, LambdaExpression expression, Times times, String failMessage) in /_/src/Moq/Mock.cs:line 331
   at Moq.Mock`1.Verify[TResult](Expression`1 expression, Func`1 times) in /_/src/Moq/Mock`1.cs:line 1033
   at OilTrading.Tests.Application.Commands.PurchaseContracts.CreatePurchaseContractCommandHandlerTests.Handle_ShouldCreatePurchaseContract_WhenValidFormulaPriceCommandProvided() in c:\Users\itg\Desktop\X\tests\OilTrading.Tests\Application\Commands\PurchaseContracts\CreatePurchaseContractCommandHandlerTests.cs:line 116
--- End of stack trace from previous location ---
  失败 OilTrading.Tests.Application.Commands.PurchaseContracts.CreatePurchaseContractCommandHandlerTests.Handle_ShouldThrowArgumentException_WhenInvalidQuantityUnit [6 ms]
  错误消息:
   Assert.Throws() Failure
Expected: typeof(System.ArgumentException)
Actual:   typeof(OilTrading.Core.Common.DomainException): Contract number cannot be null or empty
---- OilTrading.Core.Common.DomainException : Contract number cannot be null or empty
  堆栈跟踪:
     at OilTrading.Core.ValueObjects.ContractNumber.Parse(String value) in c:\Users\itg\Desktop\X\src\OilTrading.Core\ValueObjects\ContractNumber.cs:line 42
   at OilTrading.Application.Commands.PurchaseContracts.CreatePurchaseContractCommandHandler.Handle(CreatePurchaseContractCommand request, CancellationToken cancellationToken) in c:\Users\itg\Desktop\X\src\OilTrading.Application\Commands\PurchaseContracts\CreatePurchaseContractCommandHandler.cs:line 57
----- Inner Stack Trace -----
   at OilTrading.Core.ValueObjects.ContractNumber.Parse(String value) in c:\Users\itg\Desktop\X\src\OilTrading.Core\ValueObjects\ContractNumber.cs:line 42
   at OilTrading.Application.Commands.PurchaseContracts.CreatePurchaseContractCommandHandler.Handle(CreatePurchaseContractCommand request, CancellationToken cancellationToken) in c:\Users\itg\Desktop\X\src\OilTrading.Application\Commands\PurchaseContracts\CreatePurchaseContractCommandHandler.cs:line 57
[xUnit.net 00:00:02.04]     OilTrading.Tests.Application.Commands.PurchaseContracts.CreatePurchaseContractCommandHandlerTests.Handle_ShouldThrowArgumentException_WhenInvalidContractType [FAIL]
  失败 OilTrading.Tests.Application.Commands.PurchaseContracts.CreatePurchaseContractCommandHandlerTests.Handle_ShouldThrowArgumentException_WhenInvalidContractType [5 ms]
  错误消息:
   Assert.Throws() Failure
Expected: typeof(System.ArgumentException)
Actual:   typeof(OilTrading.Core.Common.DomainException): Contract number cannot be null or empty
---- OilTrading.Core.Common.DomainException : Contract number cannot be null or empty
  堆栈跟踪:
     at OilTrading.Core.ValueObjects.ContractNumber.Parse(String value) in c:\Users\itg\Desktop\X\src\OilTrading.Core\ValueObjects\ContractNumber.cs:line 42
   at OilTrading.Application.Commands.PurchaseContracts.CreatePurchaseContractCommandHandler.Handle(CreatePurchaseContractCommand request, CancellationToken cancellationToken) in c:\Users\itg\Desktop\X\src\OilTrading.Application\Commands\PurchaseContracts\CreatePurchaseContractCommandHandler.cs:line 57
----- Inner Stack Trace -----
   at OilTrading.Core.ValueObjects.ContractNumber.Parse(String value) in c:\Users\itg\Desktop\X\src\OilTrading.Core\ValueObjects\ContractNumber.cs:line 42
   at OilTrading.Application.Commands.PurchaseContracts.CreatePurchaseContractCommandHandler.Handle(CreatePurchaseContractCommand request, CancellationToken cancellationToken) in c:\Users\itg\Desktop\X\src\OilTrading.Application\Commands\PurchaseContracts\CreatePurchaseContractCommandHandler.cs:line 57

失败!  - 失败:    42，通过:   606，已跳过:     0，总计:   648，持续时间: 4 m 59 s - OilTrading.Tests.dll (net9.0)
