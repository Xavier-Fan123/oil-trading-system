# Production values for oil-trading-system
# This overrides the default values.yaml for production environment

# Global production settings
global:
  environment: production

# Production API settings
api:
  replicaCount: 5
  
  # Production resource limits
  resources:
    limits:
      cpu: 2000m
      memory: 4Gi
    requests:
      cpu: 500m
      memory: 1Gi
  
  # Production auto-scaling
  autoscaling:
    enabled: true
    minReplicas: 5
    maxReplicas: 50
    targetCPUUtilizationPercentage: 60
    targetMemoryUtilizationPercentage: 70
    
    # Custom metrics scaling
    behavior:
      scaleDown:
        stabilizationWindowSeconds: 300
        policies:
          - type: Percent
            value: 10
            periodSeconds: 60
      scaleUp:
        stabilizationWindowSeconds: 60
        policies:
          - type: Percent
            value: 50
            periodSeconds: 60
  
  # Production environment variables
  env:
    ASPNETCORE_ENVIRONMENT: "Production"
    Features__EnableRealTimeRisk: "true"
    Features__EnableAdvancedAnalytics: "true"
    Performance__EnableCaching: "true"
    Performance__CacheExpirationMinutes: "15"

# Production frontend settings
frontend:
  replicaCount: 3
  
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 200m
      memory: 256Mi
  
  autoscaling:
    minReplicas: 3
    maxReplicas: 15

# Production PostgreSQL settings
postgresql:
  auth:
    postgresPassword: "" # Retrieved from external secret
  
  primary:
    persistence:
      size: 200Gi
      storageClass: "fast-ssd"
    
    resources:
      limits:
        cpu: 4000m
        memory: 8Gi
      requests:
        cpu: 1000m
        memory: 2Gi
    
    # High availability settings
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            topologyKey: kubernetes.io/hostname
    
    # Backup configuration
    backup:
      enabled: true
      schedule: "0 2 * * *"
      retention: "30d"

# Production Redis settings
redis:
  master:
    persistence:
      enabled: true
      size: 10Gi
    
    resources:
      limits:
        cpu: 1000m
        memory: 2Gi
      requests:
        cpu: 250m
        memory: 512Mi

# Production ingress settings
ingress:
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    nginx.ingress.kubernetes.io/rate-limit: "200"
    nginx.ingress.kubernetes.io/rate-limit-window: "1m"
    nginx.ingress.kubernetes.io/proxy-body-size: "50m"
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "5"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "60"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "60"
    nginx.ingress.kubernetes.io/configuration-snippet: |
      add_header X-Frame-Options "SAMEORIGIN" always;
      add_header X-Content-Type-Options "nosniff" always;
      add_header X-XSS-Protection "1; mode=block" always;
      add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;

# Production monitoring
monitoring:
  prometheus:
    enabled: true
    retention: "30d"
    storageSize: "50Gi"
    
    # Production alert rules
    alertRules:
      enabled: true
      groups:
        - name: oil-trading-api
          rules:
            - alert: HighCPUUsage
              expr: cpu_usage > 80
              for: 5m
              labels:
                severity: warning
            - alert: HighMemoryUsage
              expr: memory_usage > 85
              for: 5m
              labels:
                severity: warning
            - alert: HighErrorRate
              expr: error_rate > 5
              for: 2m
              labels:
                severity: critical
  
  grafana:
    enabled: true
    persistence:
      enabled: true
      size: 10Gi
    
    # Production dashboards
    dashboards:
      enabled: true
      provider:
        foldersFromFilesStructure: true

# External secrets for production
externalSecrets:
  enabled: true
  secretStore:
    provider: vault
    vault:
      server: "https://vault.production.example.com"
      path: "secret/oil-trading"
      version: "v2"
  
  secrets:
    - name: database-credentials
      data:
        - secretKey: password
          remoteRef:
            key: postgresql
            property: password
    - name: redis-credentials
      data:
        - secretKey: password
          remoteRef:
            key: redis
            property: password
    - name: jwt-secrets
      data:
        - secretKey: secret
          remoteRef:
            key: auth
            property: jwt-secret

# Production backup configuration
backup:
  enabled: true
  schedule: "0 1 * * *"  # Daily at 1 AM
  retention: "30d"
  
  destinations:
    - type: s3
      bucket: "oil-trading-backups-prod"
      region: "us-west-2"

# Production security settings
security:
  podSecurityStandards:
    enforced: true
    profile: "restricted"
  
  networkPolicies:
    enabled: true
    denyAll: true
    
    # Production-specific network rules
    ingress:
      allowedNamespaces:
        - ingress-nginx
        - monitoring
    egress:
      allowedExternalHosts:
        - api.external-provider.com
        - vault.production.example.com

# Production resource quotas
resourceQuota:
  enabled: true
  hard:
    requests.cpu: "20"
    requests.memory: "40Gi"
    limits.cpu: "40"
    limits.memory: "80Gi"
    persistentvolumeclaims: "50"
    services.loadbalancers: "10"

# Production node affinity
nodeSelector:
  node-type: "production"
  environment: "production"

# Production tolerations
tolerations:
  - key: "production-workload"
    operator: "Equal"
    value: "true"
    effect: "NoSchedule"

# Production affinity rules
affinity:
  nodeAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      nodeSelectorTerms:
        - matchExpressions:
          - key: node-type
            operator: In
            values:
              - production
  
  podAntiAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchExpressions:
            - key: app.kubernetes.io/name
              operator: In
              values:
                - oil-trading-system
        topologyKey: kubernetes.io/hostname